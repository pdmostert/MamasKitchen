import{showRecipeDetailsModal as g,storage as y,showModal as b,loadHeaderFooter as C}from"./utils-DIW_K8zv.js";import{g as w}from"./recipeService-D2KBW1pu.js";class A{constructor(e="main",t=w(),n={},a=[]){this.container=document.getElementById(e),Array.isArray(t)&&t.length>0&&t[0].recipes?this.recipes=t[0].recipes:this.recipes=Array.isArray(t)?t:[],this.handlers=n,this.favoritesArr=Array.isArray(a)?a:[],this.urlFilters=this.getUrlFilters()}getUrlFilters(){const e=new URLSearchParams(window.location.search);return{type:e.get("type")||"",query:e.get("q")||"",day:e.get("day")||"",meal:e.get("meal")||""}}showRecipeDetailsModal(e){g(e)}createTag(e){const t=document.createElement("span");return t.className="tag muted",t.textContent=e,t}createRecipeCard(e){const t=document.createElement("article");t.className="recipe-card";const n=document.createElement("div");n.className="recipe-image-wrap";const a=document.createElement("img");a.src=e.image,a.alt=e.title,a.className="recipe-image",n.appendChild(a);const s=document.createElement("div");s.className="recipe-body";const i=document.createElement("div");i.className="recipe-header";const r=document.createElement("h3");r.className="meal-title",r.textContent=e.title,i.appendChild(r);const c=document.createElement("div");c.className="recipe-meta",c.innerHTML=`
      <span class="muted">${e.readyInMinutes}m</span>
      &nbsp;•&nbsp;
      <span class="muted">${e.servings}p</span>
    `;const d=document.createElement("div");d.className="recipe-tags",[...e.diets||[],...e.dishTypes||[],...e.cuisines||[]].forEach(o=>{d.appendChild(this.createTag(o))});const m=document.createElement("div");m.className="recipe-actions";const p=document.createElement("button");p.className="nav-btn",p.textContent="View Recipe",p.addEventListener("click",()=>this.showRecipeDetailsModal(e));const h=document.createElement("button");h.className="nav-btn primary",h.textContent="Add to Plan",h.addEventListener("click",()=>this.showAddToPlanModal(e));const l=document.createElement("button"),u=this.favoritesArr.some(o=>o&&typeof o=="object"&&"id"in o&&o.id===e.id);return l.className="favorite-btn "+(u?"favorite-active":"favorite-inactive"),l.setAttribute("aria-label",u?"Remove from favorites":"Add to favorites"),l.innerHTML=u?"♥ Favorites":"♡ Favorite",l.addEventListener("click",()=>{let o=y.getFavorites()||[];o.some(f=>f.id===e.id)?(o=o.filter(f=>f.id!==e.id),l.className="favorite-btn favorite-inactive",l.setAttribute("aria-label","Add to favorites"),l.innerHTML="♡ Favorite",window.toast&&typeof window.toast.info=="function"&&window.toast.info(`Removed ${e.title} from favorites`)):(o.push(e),l.className="favorite-btn favorite-active",l.setAttribute("aria-label","Remove from favorites"),l.innerHTML="♥ Favorites",window.toast&&typeof window.toast.success=="function"&&window.toast.success(`Added ${e.title} to favorites`)),y.setFavorites(o),this.favoritesArr=o,this.handlers.onToggleFavorite(e)}),m.appendChild(p),m.appendChild(h),m.appendChild(l),s.appendChild(i),s.appendChild(c),s.appendChild(d),s.appendChild(m),t.appendChild(n),t.appendChild(s),t}showAddToPlanModal(e){const{day:t,meal:n}=this.urlFilters,a=`
    <div class="modal-recipe-info"><strong>Recipe</strong><br>${e.title}</div>
    <label class="modal-label" for="modal-day-select">Day</label>
    <select id="modal-day-select" class="modal-select">
      <option value="">Select a day</option>
      ${["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(s=>`<option value='${s}' ${s===t?"selected":""}>${s}</option>`).join("")}
    </select>
    <label class="modal-label" for="modal-mealtype-select">Meal Type</label>
    <select id="modal-mealtype-select" class="modal-select">
      <option value="">Select meal type</option>
      ${["breakfast","lunch","dinner","snack"].map(s=>`<option value='${s}' ${s===n?"selected":""}>${s.charAt(0).toUpperCase()+s.slice(1)}</option>`).join("")}
    </select>
    <div class="modal-btn-row"></div>
  `;b({title:"Add to Meal Plan",content:a,onClose:null,modalClass:"add-to-plan-modal"}),setTimeout(()=>{const s=document.createElement("button");s.className="modal-btn modal-confirm",s.textContent="Add to Plan",s.onclick=()=>{const r=document.getElementById("modal-day-select").value,c=document.getElementById("modal-mealtype-select").value;if(!r||!c){alert("Please select both day and meal type.");return}let d={};try{d=JSON.parse(localStorage.getItem("mealPlannerMealPlan"))||{}}catch{d={}}d[r]||(d[r]={}),d[r][c]=e,localStorage.setItem("mealPlannerMealPlan",JSON.stringify(d)),document.getElementById("global-modal").remove(),window.toast&&typeof window.toast.success=="function"?window.toast.success(`Added ${e.title} to ${r} ${c}`):alert(`Added ${e.title} to ${r} ${c}`)},document.querySelector("#global-modal .modal-btn-row").appendChild(s)},0)}renderList(e){let t=this.container.querySelector(".recipes-grid");t||(t=document.createElement("div"),t.className="recipes-grid",this.container.appendChild(t)),t.innerHTML="",(Array.isArray(e)?e:e.recipes||[]).forEach(a=>{const s=this.createRecipeCard(a);t.appendChild(s)})}filterRecipes(e){const t=(e||"").toLowerCase().trim(),n=this.urlFilters.type.toLowerCase();return this.recipes.filter(a=>!(t&&!(a.title.toLowerCase().includes(t)||(a.ingredients||[]).some(i=>i.name.toLowerCase().includes(t))||(a.dishTypes||[]).some(i=>i.toLowerCase().includes(t))||(a.cuisines||[]).some(i=>i.toLowerCase().includes(t))||(a.diets||[]).some(i=>i.toLowerCase().includes(t)))||n&&!(a.dishTypes||[]).map(i=>i.toLowerCase()).some(i=>i.includes(n))))}renderSearchHeader(){const e=document.createElement("div");e.className="search-header";const t=document.createElement("h2");t.className="page-title",t.textContent="Search Recipes";const n=document.createElement("input");n.type="search",n.placeholder="Search recipes, ingredients, or tags...",n.className="search-input",n.id="recipe-search-input";const a=document.createElement("button");return a.className="nav-btn",a.textContent="Filters",e.appendChild(t),e.appendChild(n),e.appendChild(a),n.addEventListener("input",()=>{const s=this.filterRecipes(n.value);this.renderList(s)}),e}render(){if(!this.container.querySelector(".search-header")){this.container.innerHTML="";const n=this.renderSearchHeader();this.container.appendChild(n),this.urlFilters.type&&this.showActiveFilter()}const e=document.getElementById("recipe-search-input");e&&this.urlFilters.query&&(e.value=this.urlFilters.query);const t=this.filterRecipes(this.urlFilters.query);this.renderList(t)}showActiveFilter(){const e=document.createElement("div");e.className="active-filter-info",e.innerHTML=`
      <span>Filtered by: <strong>${this.urlFilters.type}</strong></span>
      <button onclick="window.location.href='${window.location.pathname}'" class="clear-filter-btn">Clear Filter</button>
    `,this.container.insertBefore(e,this.container.children[1])}updateFavorites(e){this.favoritesArr=Array.isArray(e)?e:[],this.renderList(this.recipes)}}document.addEventListener("DOMContentLoaded",async()=>{C();const v=await w(),e={onView:a=>{alert(`View: ${a.title}`)},onAddToPlan:a=>{alert(`Add to plan: ${a.title}`)},onToggleFavorite:a=>{alert(`Toggle favorite: ${a.title}`)}},t=y.getFavorites()||[];new A("main",v,e,t).render()});
